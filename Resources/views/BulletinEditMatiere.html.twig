{% extends "ClarolineCoreBundle:Workspace:layout.html.twig" %}

{% block section_content %}
    <div class="panel-heading">
     <h1>{{ periode.getName() }} - {{ matiere.getCourse().getTitle() }} - {{ matiere.getName() }} - {{user}}</h1>
    </div>
    <div class="panel-body">
        <div class="panel panel-info">
            <div class="panel-heading">Valeurs particulières</div>
            <div class="panel-body">
                Certificat médical : <b>888</b><br />
                Non évalué : <b>999</b><br/>
                N'oubliez pas d'<b>enregistrer</b> en cliquant sur le bouton en bas de page
            </div>
        </div>
        <form action="" method="POST" {{ form_enctype(form) }} autocomplete="off">
            <table class="table">
                <thead><tr>
                    <th>Élève</th>
                    <th>Point</th>
                    <th>Total</th>
                    {% if periode.onlyPoint != 1 %}
                    
                        {% if hasSecondPoint %}
                            <th>{{ secondPointName }} ( % )</th>
                        {% endif %}
                    
                        {% if hasThirdPoint %}
                            <th>{{ thirdPointName }} ( / 10 )</th>
                        {% endif %}
                    {% endif %}
                </tr></thead>
                <tbody>
                {% for pemp in form.pemps %}
                    <tr>
                        <td>
                            {% for eleve in eleves %}
                                {% if eleve.getId()== pemp.vars.value.eleve.getId %}
                                {{eleve.getLastName()}} {{eleve.getFirstName()}}
                                {% endif %}
                            {% endfor %}    
                        </td>
                        <td class="point">{{ form_widget(pemp.point)}}</td>                    
                        <td class="total">{{ form_widget(pemp.total) }}</td>
                        {% if periode.onlyPoint != 1 %}
                    
                            {% if hasSecondPoint %}
                                <td class="presence">{{ form_widget(pemp.presence) }}</td>
                            {% endif %}

                            {% if hasThirdPoint %}
                                <td class="comportement">{{ form_widget(pemp.comportement) }}</td>
                            {% endif %}
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% if lock == true %}
                <a class="btn btn-warning unlock-btn">
                    {{ "Modifier" }}
                </a>
            {% else %}
                {{ form_widget(form.save) }}
            {% endif %}
        </form>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script
            src='{{ asset('bundles/formalibrebulletin/js/bulletinEdit.js') }}'
            type="text/javascript">
    </script>
    <script>
        $(".unlock-btn").on("click",function(){
            var matiere ={{ matiere.getId() }};
            var periode ={{ periode.getId() }};
            $.ajax({
                url: Routing.generate("formalibreBulletinUnlockPoint", {"session":matiere, "periode":periode}),
                success: function(data) {
                    window.location.reload();
                }    
            });
     });
    </script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/formalibrebulletin/css/bulletinEdit.css')}}"/>
{% endblock %}
